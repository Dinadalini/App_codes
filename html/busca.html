<!-- busca.html -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Busca</title>
    <link rel="stylesheet" href="../css/busca.css">
    <link rel="stylesheet" href="../css/lugar.css">
    <link rel="stylesheet" href="../css/reset.css">
    <style>
        #map {
            width: 100%;
            height: 50vh;
            object-fit: cover;
        }
        .info-box {
            position: absolute;
            bottom: 55%;
            left: 50%;
            transform: translateX(-50%);
            background-color: white;
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            z-index: 1000;
            font-size: 1rem;
        }
    </style>
</head>
<body>
    <header>
        <a href="../index.html" class="btn-voltar">←</a>
    </header>

    <div id="map"></div>

    <main>
        <p>Insper - Localização Atual</p>
        <p class="busca">
            <a href="lugar.html">
                <img src="../img/lupa.png" class="lupa" alt="Ícone de busca">
                Buscar
            </a>
        </p>
        <p>Recentes:</p>
        <ul>
            <p>• Pinheiros, Rua Pinheiro, 0</p>
        </ul>
    </main>

    <script>
        let map, directionsService, directionsRenderer;

        function initMap() {
            const insper = { lat: -23.597, lng: -46.685 };

            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 15,
                center: insper,
            });

            new google.maps.Marker({
                position: insper,
                map: map,
            });

            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer();
            directionsRenderer.setMap(map);

            const params = new URLSearchParams(window.location.search);
            const rota = params.get("rota");

            if (rota === "pinheiros") {
                calcularRota([
                    { lat: -23.597, lng: -46.685 },
                    "Rua dos Pinheiros, São Paulo"
                ]);
            } else if (rota === "dona_rosa") {
                calcularRota([
                    { lat: -23.597, lng: -46.685 },
                    "Pizzaria Dona Rosa, São Paulo",
                    "Rua dos Pinheiros, São Paulo"
                ]);
            }
        }

        function calcularRota(pontos) {
            const waypoints = pontos.slice(1, -1).map(endereco => ({
                location: endereco,
                stopover: true
            }));

            directionsService.route(
                {
                    origin: pontos[0],
                    destination: pontos[pontos.length - 1],
                    waypoints,
                    travelMode: google.maps.TravelMode.DRIVING,
                },
                (response, status) => {
                    if (status === "OK") {
                        directionsRenderer.setDirections(response);

                        const legs = response.routes[0].legs;
                        let totalDist = 0;
                        let totalTime = 0;

                        legs.forEach((leg) => {
                            totalDist += leg.distance.value;
                            totalTime += leg.duration.value;
                        });

                        const distancia = (totalDist / 1000).toFixed(1) + " km";
                        const duracao = Math.floor(totalTime / 60) + " min";

                        const infoBox = document.createElement("div");
                        infoBox.className = "info-box";
                        infoBox.innerText = `Tempo estimado: ${duracao} • Distância: ${distancia}`;
                        document.body.appendChild(infoBox);
                    } else {
                        alert("Erro ao calcular rota: " + status);
                    }
                }
            );
        }

        window.initMap = initMap;
    </script>

    <script async
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAFAs5TDrQC95V4cZ9qHi9kM913bTXsPW8&callback=initMap">
    </script>
</body>
</html>
